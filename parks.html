<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dash</title>
    <!-- css link  -->
    <link rel="stylesheet" href="css/style.css" />
    <!-- font awesome  -->
  
  <link
    rel="shortcut icon"
    href="./assets/images/logo.png"
    type="image/svg+xml"
  />

  <!-- 
  - custom css link
-->
  <link rel="stylesheet" href="./assets/css/style.css" />

  <!-- font awesome  -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

  <!-- 
  - google font link
-->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700&family=Poppins:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <link rel="stylesheet" href="css/main.css">

  <style>

  </style>
  </head>
  <body>

    <aside class="sidebar " id="sidebar">
      <header>
        <div class="image-text">
          <span class="image">
            <img src="img/logo.png" alt="" />
          </span>

          <div class="text header-text">
            <span class="name">garashko</span>
            <span class="profession">web developer</span>
          </div>
        </div>

        <i class="fa-solid fa-angle-right toggle" id="close-toggle"></i>
      </header>

      <div class="menu-bar">
        <div class="menu">
          <ul class="menu-links">
            <li class="navlink">
              <input type="search" name="" id="" placeholder=" search" />
              <a href="#">
                <i class="fa-solid fa-magnifying-glass search"></i>
              </a>
            </li>
            <li class="navlink">
              <a href="index.html">
                <i class="fa-solid fa-house icon"></i>
                <span class="text nav-text">Dashboard</span>
              </a>
            </li>
            <li class="navlink">
              <a href="#">
                <i class="fa-solid fa-chart-pie icon"></i>
                <span class="text nav-text">users</span>
              </a>
            </li>
            <li class="navlink">
              <a href="#">
                <i class="fa-solid fa-chart-line icon"></i>
                <span class="text nav-text">vehicles</span>
              </a>
            </li>
            <li class="navlink">
              <a href="parks.html">
                <i class="fa-solid fa-users icon"></i>
                <span class="text nav-text">parks</span>
              </a>
            </li>
            <li class="navlink">
              <a href="#">
                <i class="fa-solid fa-circle-dollar-to-slot icon"></i>
                <span class="text nav-text">Transactions</span>
              </a>
            </li>
            <li class="navlink">
              <a href="#">
                <i class="fa-solid fa-trowel-bricks icon"></i>
                <span class="text nav-text">Gain</span>
              </a>
            </li>
            <li class="navlink">
              <a href="#">
                <i class="fa-solid fa-chart-simple icon"></i>
                <span class="text nav-text">Charts</span>
              </a>
            </li>
            <li class="navlink">
              <a href="#">
                <i class="fa-solid fa-bell icon"></i>
                <span class="text nav-text">Notification</span>
              </a>
            </li>
            <li class="navlink">
              <a href="#">
                <i class="fa-solid fa-gear icon"></i>
                <span class="text nav-text">Settings</span>
              </a>
            </li>
            <li class="navlink">
              <a href="#">
                <i class="fa-solid fa-user-pen icon"></i>
                <span class="text nav-text">Acount</span>
              </a>
            </li>
            <li class="navlink">
              <a href="#">
                <i class="fa-solid fa-right-from-bracket icon"></i>
                <span class="text nav-text">Logout</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </aside>

    <section class="head">
      <ul>
        <li><i class="fa-solid fa-bell icon"></i></li>
        <li><img src="img/prof1.png" alt="" /></li>
      </ul>
    </section>
    <section class="main">
      
      <section class="parks">
        <div class="container">
          <div class="grid-boxes">
          </div>
        </div>
      </section>
      
      <section class="add-park">
        <div class="container">
          <h3>add park</h3>
          <a href="#" class="btn" onclick="addPark()">add park</a>
        </div>
      </section>
      <section class="deletall">
        <div class="container">
          <h3>delete all parks</h3>

        <a href="#" class="btn" onclick="deleteAllParks()">delet parks</a>
        </div>
      </section>


      <section class="add">
        <div class="fas fa-times" id="close-btn-add"></div>
        <form id="addParkingForm">
          <label for="parking_name">Park Name:</label>
          <input type="text" id="parking_name" name="parking_name" />
          <label for="city">City:</label>
          <input type="text" id="city" name="city" />
          <label for="state">State:</label>
          <input type="text" id="state" name="state" />
          <label for="address">Address:</label>
          <input type="text" id="address" name="address" />
          <label for="totalPlace">Total Places</label>
          <input type="number" id="totalPlace" name="totalPlace" />
          <label for="creditPointPerHour">credit Point Per Hour</label>
          <input
            type="number"
            id="creditPointPerHour"
            name="creditPointPerHour"
          />
          <label for="locationMap">خريطة الموقع:</label>
          <input type="text" id="locationMap" name="locationMap" />
          <label for="creditPointPerMonth">نقاط الائتمان في الشهر:</label
          >
          <input
            type="number"
            id="creditPointPerMonth"
            name="creditPointPerMonth"
          />
          <input type="submit" value="إضافة جراج" />
        </form>
      </section>

      <section class="edit">
        <div class="fas fa-times" id="close-btn"></div>
        <form id="editParkingForm">
          <label for="parking_nameEdit">Park Name:</label>
          <input type="text" id="parking_nameEdit" name="parking_name" />
          <label for="cityEdit">City:</label>
          <input type="text" id="cityEdit" name="city" />
          <label for="stateEdit">State:</label>
          <input type="text" id="stateEdit" name="state" />
          <label for="addressEdit">Address:</label>
          <input type="text" id="addressEdit" name="address" />
          <label for="totalPlaceEdit">Total Places</label>
          <input type="number" id="totalPlaceEdit" name="totalPlace" />
          <label for="creditPointPerHourEdit">credit Point Per Hour</label>
          <input
            type="number"
            id="creditPointPerHourEdit"
            name="creditPointPerHour"
          />
          <label for="locationMapEdit">خريطة الموقع:</label>
          <input type="text" id="locationMapEdit" name="locationMap" />
          <label for="creditPointPerMonthEdit">نقاط الائتمان في الشهر:</label>
          <input
            type="number"
            id="creditPointPerMonthEdit"
            name="creditPointPerMonth"
          />
          <input type="submit" value="تعديل" />
        </form>
      </section>
    </article>
  </main>





  <script
    type="module"
    src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
  ></script>
  <script
    nomodule
    src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
  ></script>
  <script>
    const token = JSON.parse(localStorage.getItem("token"));

    function ParkingData() {
      const gridBoxes = document.querySelector(".grid-boxes");

      fetch("https://gara4ko-p8wm.onrender.com/api/v1/parking", {
        method: "GET",
        headers: {
          token: token,
        },
      })
        .then((response) => response.json())
        .then((data) => {
          console.log(data);
          for (let i = 0; i < data.data.length; i++) {
            const parking = data.data[i];

            const box = document.createElement("div");
            box.className = "box";

            box.innerHTML = `
            <img src="https://i.ibb.co/kx7BNHB/service-1.png" alt="">
  <h3 class="parkName">${parking.parking_name}</h3>
  <p class="location"><span class="city">${parking.location.city}</span>${
                parking.location.address
              }</p>
  <p class="cridPrice"> ${
    parking.creditPointPerHour
  } <span class="crid">cridet point per hour</span></p>
  <p class="cridPrice"> ${
    parking.creditPointPerMonth
  } <span class="crid">cridet point per month</span></p>
  <p class="rating">${getStars(parking.rate)} <span class="crid"></span></p>
  <p class="cridPrice"> ${
    parking.remainingSpace
  } <span class="crid">remaining Space</span></p>
                <div class="btns">
                  <a href="#" class="btn" onclick="editPark('${parking._id}')">edit</a>
                  <a href="#" class="btn" onclick="deletePark('${parking._id}')">delete</a>
                </div>
              `;

            gridBoxes.appendChild(box);
          }
        })
        .catch((error) => console.error("Error:", error));
    }


    
    function addPark() {

      var element = document.querySelector('.add');

// إضافة الكلاس 'show' إلى العنصر
element.classList.add('show');


      document
        .getElementById("addParkingForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          // تحويل قيمة locationMap إلى كائن
          let locationMapValue = document.getElementById("locationMap").value;
          let locationMapObject = {};
          try {
            locationMapObject = JSON.parse(locationMapValue);
          } catch (error) {
            console.error("Parsing error:", error);
          }

          let data = {
            parking_name: document.getElementById("parking_name").value,
            city: document.getElementById("city").value,
            state: document.getElementById("state").value,
            address: document.getElementById("address").value,
            totalPlace: document.getElementById("totalPlace").value,
            creditPointPerHour:
              document.getElementById("creditPointPerHour").value,
            locationMap: locationMapObject, // استخدام الكائن هنا
            creditPointPerMonth: document.getElementById(
              "creditPointPerMonth"
            ).value,
          };

          fetch("https://gara4ko-p8wm.onrender.com/api/v1/parking", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              token: token,
            },
            body: JSON.stringify(data),
          })
            .then((response) => response.json())
            .then((data) => {
              console.log(data);
              // مسح البيانات من النموذج
              document.getElementById("parking_name").value = "";
              document.getElementById("city").value = "";
              document.getElementById("state").value = "";
              document.getElementById("address").value = "";
              document.getElementById("totalPlace").value = "";
              document.getElementById("creditPointPerHour").value = "";
              document.getElementById("locationMap").value = "";
              document.getElementById("creditPointPerMonth").value = "";
              // إظهار رسالة تأكيد بعد إضافة الجراج
              swal({
                title: "تم!",
                text: "تم إضافة الجراج بنجاح",
                icon: "success",
                buttons: {
                  confirm: {
                    text: "موافق",
                    value: true,
                    visible: true,
                    closeModal: true,
                  },
                },
                closeOnClickOutside: false,
              }).then((value) => {
                location.reload();
              });
            })
            .catch((error) => {
              console.error("Error:", error);
              swal({
                title: "خطأ!",
                text: "حدث خطأ أثناء إضافة الجراج",
                icon: "error",
                buttons: {
                  confirm: {
                    text: "موافق",
                    value: true,
                    visible: true,
                    closeModal: true,
                  },
                },
                closeOnClickOutside: false,
              });
            });
        });
    }

    function fillForm(id) {
  fetch(`https://gara4ko-p8wm.onrender.com/api/v1/parking/${id}`, {
    method: "GET",
    headers: {
      token: token,
    },
  })
    .then((response) => response.json())
    .then((data) => {
      const parking = data.data;
      document.getElementById("parking_nameEdit").value = parking.parking_name;
      document.getElementById("cityEdit").value = parking.location.city;
      document.getElementById("stateEdit").value = parking.location.state;
      document.getElementById("addressEdit").value = parking.location.address;
      document.getElementById("totalPlaceEdit").value = parking.totalPlace;
      document.getElementById("creditPointPerHourEdit").value = parking.creditPointPerHour;
      document.getElementById("locationMapEdit").value = JSON.stringify(parking.locationMap);
      document.getElementById("creditPointPerMonthEdit").value = parking.creditPointPerMonth;
    })
    .catch((error) => console.error("Error:", error));
}

function editPark(id) {
  fillForm(id); // ملء النموذج ببيانات الجراج

  var element = document.querySelector('.edit');

// إضافة الكلاس 'show' إلى العنصر
element.classList.add('show');

  document
    .getElementById("editParkingForm")
    .addEventListener("submit", function (event) {
      event.preventDefault();

      // تحويل قيمة locationMap إلى كائن
      let locationMapValue = document.getElementById("locationMapEdit").value;
      let locationMapObject = {};
      try {
        locationMapObject = JSON.parse(locationMapValue);
      } catch (error) {
        console.error("Parsing error:", error);
      }

      let data = {
        parking_name: document.getElementById("parking_nameEdit").value,
        city: document.getElementById("cityEdit").value,
        state: document.getElementById("stateEdit").value,
        address: document.getElementById("addressEdit").value,
        totalPlace: document.getElementById("totalPlaceEdit").value,
        creditPointPerHour:
          document.getElementById("creditPointPerHourEdit").value,
        locationMap: locationMapObject, // استخدام الكائن هنا
        creditPointPerMonth: document.getElementById(
          "creditPointPerMonthEdit"
        ).value,
      };

      fetch(`https://gara4ko-p8wm.onrender.com/api/v1/parking/${id}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          token: token,
        },
        body: JSON.stringify(data),
      })
        .then((response) => response.json())
        .then((data) => {
          console.log(data);
          swal("تم!", "تم تعديل الجراج بنجاح", "success");
          // location.reload();
        })
        .catch((error) => {
          console.error("Error:", error);
          swal("خطأ!", "حدث خطأ أثناء تعديل الجراج", "error");
        });
    });
}

    function deletePark(id) {
      swal({
        title: "هل أنت متأكد؟",
        text: "هل تريد حذف الجراج؟",
        icon: "warning",
        buttons: ["لا", "نعم"],
        dangerMode: true,
      }).then((willDelete) => {
        if (willDelete) {
          fetch(`https://gara4ko-p8wm.onrender.com/api/v1/parking/${id}`, {
            method: "DELETE",
            headers: {
              token: token,
            },
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.json();
            })
            .then((data) => {
              console.log(data);
              swal("تم!", "تم حذف الجراج بنجاح", "success");
              location.reload();
            })
            .catch((error) => {
              console.error("Error:", error);
              swal("خطأ!", "حدث خطأ أثناء حذف الجراج", "error");
            });
        } else {
          swal("تم إلغاء الحذف");
        }
      });
    }

  document.getElementById('close-btn').addEventListener('click', function() {
  var element = document.querySelector('.edit');
  element.classList.remove('show');
});

  document.getElementById('close-btn-add').addEventListener('click', function() {
  var element = document.querySelector('.add');
  element.classList.remove('show');
});




  ParkingData();









  function deleteAllParks() {
  swal({
    title: "هل أنت متأكد؟",
    text: "هل تريد حذف جميع الجراجات؟",
    icon: "warning",
    buttons: ["لا", "نعم"],
    dangerMode: true,
  }).then((willDelete) => {
    if (willDelete) {
      fetch(`https://gara4ko-p8wm.onrender.com/api/v1/parking`, {
        method: "GET",
        headers: {
          token: token,
        },
      })
        .then((response) => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then((data) => {
  console.log(data); // طباعة البيانات
  if (Array.isArray(data.data)) { // تحقق من أن data.data هو مصفوفة
    data.data.forEach((park) => { // استخدم data.data.forEach بدلاً من data.forEach
      fetch(`https://gara4ko-p8wm.onrender.com/api/v1/parking/${park._id}`, {
        method: "DELETE",
        headers: {
          token: token,
        },
      });
    });
    swal("تم!", "تم حذف جميع الجراجات بنجاح", "success");
    // location.reload();
  } else {
    console.error("Error: data.data is not an array");
    swal("خطأ!", "حدث خطأ أثناء حذف الجراجات", "error");
  }
})


    } else {
      swal("تم إلغاء الحذف");
    }
  });
}





    
  </script>
  <script src="assets/js/script.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="js/main.js"></script>
  </body>
</html>
